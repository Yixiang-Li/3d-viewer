<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- 添加 theme-color，让 Discord 嵌入条颜色匹配 -->
    <meta name="theme-color" content="#ccff00">
    <title>You're Invited to Meshy | Claim Your Free Month</title>

    <!-- ================================================================================== -->
    <!--                          社交媒体预览配置 (Social Media Preview)                     -->
    <!-- ================================================================================== -->

    <!-- 1. 通用 Open Graph 配置 (基础层) -->
    <!-- 适用：WhatsApp, Facebook, LinkedIn (它们只读这里) -->
    <!-- [关键修改] 将类型改为 video.other -->
    <!-- 原因：当存在 twitter:card=player 时，Telegram 会默认忽略 og:video。 -->
    <!-- 改为 video.other 可以强制告诉 Telegram "这是一个视频页面"，从而激活 MP4 自动播放 -->
    <meta property="og:type" content="video.other">
    <meta property="og:title" content="Your friend gifted you a free month on Meshy!">
    <meta property="og:description" content="Interact with this 3D model and claim your reward to start creating.">
    <meta property="og:url" content="https://yixiang-li.github.io/3d-viewer/">
    
    <!-- [WhatsApp 安全区] 静态图放在第一位，确保被抓取 -->
    <meta property="og:image" content="https://cdn.meshy.ai/referral-assets/cup_cdn.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/png">

    <!-- 2. 视频增强层 (Telegram, Discord, Slack) -->
    <!-- 它们会忽略上面的静态图，优先播放这里的 MP4 -->
    <meta property="og:video" content="https://cdn.meshy.ai/referral-assets/cup2.mp4">
    <!-- [建议添加] secure_url 用于兼容严格的 HTTPS 客户端 -->
    <meta property="og:video:secure_url" content="https://cdn.meshy.ai/referral-assets/cup2.mp4">
    <meta property="og:video:type" content="video/mp4">
    <meta property="og:video:width" content="1280">
    <meta property="og:video:height" content="720">

    <!-- 3. Twitter (X) Player Card 配置 -->
    <meta name="twitter:card" content="player">
    <meta name="twitter:site" content="@MeshyAI">
    <meta name="twitter:title" content="Your friend gifted you a free month on Meshy!">
    <meta name="twitter:description" content="Interact with this 3D model and claim your reward to start creating.">
    
    <!-- [修正] 建议改回静态 PNG。 -->
    <!-- 原因：Player Card 需要一张加载极快的高清封面。GIF 可能会导致封面加载失败。 -->
    <meta name="twitter:image" content="https://cdn.meshy.ai/referral-assets/cup_cdn.png">

    <!-- Player Iframe 地址 -->
    <meta name="twitter:player" content="https://yixiang-li.github.io/3d-viewer/index.html?mode=embed&v=ratio_fix_v1">
    <meta name="twitter:player:width" content="1280">
    <meta name="twitter:player:height" content="720">

    <!-- ... 其余脚本保持不变 ... -->
    
    <!-- 提前执行的 Embed 检测脚本 -->
    <script>
        (function() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const isEmbed = urlParams.get('mode') === 'embed';
                if (isEmbed) {
                    document.documentElement.classList.add('embed-mode');
                    window.__IS_EMBED__ = true;
                }
            } catch (e) { console.error(e); }
        })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        meshy: {
                            bg: '#050505',
                            card: '#111111',
                            accent: '#ccff00',
                            accentHover: '#b3e600',
                            text: '#ffffff',
                            subtext: '#9ca3af',
                            border: '#222222',
                            panel: 'rgba(20, 20, 20, 0.85)'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'neon': '0 0 15px rgba(204, 255, 0, 0.3)',
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        body { background-color: #050505; color: white; font-family: 'Inter', sans-serif; overflow-x: hidden; }

        /* ================= 布局系统 ================= */
        
        #app-layout {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 55vh 1fr; 
            width: 100vw;
            min-height: 100vh;
        }

        @media (min-width: 1024px) {
            #app-layout {
                grid-template-columns: 1.2fr 0.8fr;
                grid-template-rows: 100vh;
            }
        }

        #canvas-col {
            position: relative;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
            overflow: hidden;
        }

        #content-col {
            position: relative;
            z-index: 10;
            background: #050505;
            border-top: 1px solid #222;
        }

        @media (min-width: 1024px) {
            #content-col {
                border-top: none;
                border-left: 1px solid #222;
            }
        }

        /* ================= Embed Mode (纯净模式) ================= */
        
        html.embed-mode body { overflow: hidden; }
        
        html.embed-mode #app-layout {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        html.embed-mode #canvas-col {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
        }

        /* [修改] 隐藏逻辑：
           保留了 #left-sidebar (工具栏) 和 #pbr-popup
           隐藏了 #content-col (右侧文案), #stats-panel (左上角数据), #bottom-bar (底部状态栏)
        */
        html.embed-mode #content-col,
        html.embed-mode .landing-only, /* 专门用于 Landing 页的元素 */
        html.embed-mode #stats-panel,
        html.embed-mode #bottom-bar { 
            display: none !important; 
        }

        /* 显示纯净模式 CTA */
        html.embed-mode #embed-cta {
            display: flex !important;
        }

        /* ================= UI 组件样式 ================= */

        /* 范围滑块自定义 */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 10px;
            width: 10px;
            border-radius: 50%;
            background: #ccff00;
            cursor: pointer;
            margin-top: -3px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #444;
            border-radius: 2px;
        }

        /* 玻璃质感工具栏 */
        .glass-panel {
            background: var(--meshy-panel);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* 工具栏按钮 */
        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            transition: all 0.2s;
            background: transparent;
        }
        .tool-btn:hover, .tool-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

        /* 截图闪光 */
        @keyframes flash { 0% { opacity: 1; } 100% { opacity: 0; } }
        .do-flash { position: fixed; inset: 0; background: white; z-index: 100; animation: flash 0.3s ease-out forwards; pointer-events: none; }
    </style>

    <script type="importmap">
        { "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js", "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/" } }
    </script>
</head>
<body class="antialiased">

    <!-- 布局容器 -->
    <div id="app-layout">
        
        <!-- 左侧/上方: 3D 区域 -->
        <div id="canvas-col">
            <div id="canvas-wrapper" class="w-full h-full"></div>
            
            <!-- 1. 左上角：统计数据 (标记为 landing-only，只在主页显示) -->
            <div id="stats-panel" class="landing-only absolute top-6 left-6 glass-panel rounded-lg p-3 min-w-[140px] pointer-events-none select-none z-20">
                <div class="grid grid-cols-2 gap-y-1 gap-x-3 text-[10px] font-mono text-gray-400">
                    <span>Faces</span> <span class="text-white text-right">40,502</span>
                    <span>Vertices</span> <span class="text-white text-right">26,315</span>
                </div>
            </div>

            <!-- 2. 左侧边栏：核心工具 (去掉了 landing-only 类，使其在 Embed 模式也保留) -->
            <div id="left-sidebar" class="absolute top-24 left-6 flex flex-col gap-2 z-20">
                <div class="glass-panel rounded-lg p-1 flex flex-col gap-1">
                    <!-- 材质 PBR 设置 -->
                    <button class="tool-btn" id="btn-pbr" onclick="togglePBRPopup()" title="Material Settings">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                    </button>
                    <!-- 线框模式 -->
                    <button class="tool-btn" id="btn-wireframe" onclick="toggleWireframe()" title="Toggle Wireframe">
                        <i class="fa-solid fa-border-all"></i>
                    </button>
                    <!-- 截图 -->
                    <button class="tool-btn" onclick="takeScreenshot()" title="Capture Screenshot">
                        <i class="fa-solid fa-camera"></i>
                    </button>
                </div>
            </div>

            <!-- PBR 设置弹窗 (保留在 Embed 模式) -->
            <div id="pbr-popup" class="hidden absolute top-24 left-20 glass-panel rounded-lg p-4 w-48 z-30 animate-fade-in">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Material</span>
                    <button onclick="togglePBRPopup()" class="text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                            <span>Roughness</span> <span id="val-roughness" class="text-white font-mono">0.5</span>
                        </div>
                        <input type="range" min="0" max="1" step="0.01" value="0.5" oninput="updateMaterial('roughness', this.value)">
                    </div>
                    <div>
                        <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                            <span>Metalness</span> <span id="val-metalness" class="text-white font-mono">0.1</span>
                        </div>
                        <input type="range" min="0" max="1" step="0.01" value="0.1" oninput="updateMaterial('metalness', this.value)">
                    </div>
                </div>
            </div>

            <!-- 3. 底部居中：状态栏/导航 (标记为 landing-only，保持 embed 模式底部干净) -->
            <div id="bottom-bar" class="landing-only absolute bottom-6 left-1/2 -translate-x-1/2 glass-panel rounded-full px-5 py-2 flex items-center gap-5 z-20 select-none">
                <div class="flex items-center gap-2 text-[10px] text-meshy-accent font-bold px-2 py-0.5 bg-meshy-accent/10 rounded border border-meshy-accent/20 uppercase tracking-wide">
                    <i class="fa-solid fa-bolt"></i> Preview
                </div>
                <div class="w-px h-3 bg-white/10"></div>
                <div class="flex items-center gap-4 text-xs text-gray-400">
                    <span class="flex items-center gap-1.5"><i class="fa-solid fa-mouse"></i> Orbit</span>
                    <span class="flex items-center gap-1.5"><i class="fa-solid fa-hand"></i> Pan</span>
                </div>
                <div class="w-px h-3 bg-white/10"></div>
                <label class="flex items-center gap-2 cursor-pointer group">
                    <span class="text-xs text-gray-400 group-hover:text-white transition"><i class="fa-solid fa-rotate mr-1"></i> Auto</span>
                    <input type="checkbox" checked onchange="toggleAutoRotate(this.checked)" class="accent-meshy-accent w-3 h-3 cursor-pointer">
                </label>
            </div>

            <!-- Embed 模式 CTA (左下角) -->
            <a id="embed-cta" href="https://meshy.ai" target="_blank" style="display:none;" class="absolute bottom-5 left-5 z-50 bg-white text-black py-2.5 px-5 rounded-full font-bold text-sm flex items-center gap-2 hover:scale-105 transition-transform shadow-lg no-underline cursor-pointer">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5 9.5 9.75 12 11zm0 2.5l-5-2.5-5 2.5 10 5 10-5-5-2.5-5 2.5z"/></svg>
                Claim Gift on Meshy
            </a>
            
            <div id="flash-overlay"></div>
        </div>

        <!-- 右侧/下方: 礼品信息区域 (保持原样) -->
        <div id="content-col" class="flex flex-col justify-center items-center p-6 lg:p-12 overflow-y-auto custom-scrollbar">
            
            <!-- Logo -->
            <div class="absolute top-6 left-6 lg:top-8 lg:left-8 flex items-center gap-2 text-meshy-accent font-bold text-xl tracking-tight">
                <svg class="w-7 h-7 fill-current" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5 9.5 9.75 12 11zm0 2.5l-5-2.5-5 2.5 10 5 10-5-5-2.5-5 2.5z"/></svg>
                Meshy
            </div>

            <div class="w-full max-w-lg space-y-6">
                
                <!-- Invited By 卡片 -->
                <div class="relative group mt-8 lg:mt-0">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-meshy-accent to-blue-500 rounded-2xl opacity-20 group-hover:opacity-40 blur transition duration-500"></div>
                    
                    <div class="relative bg-meshy-card rounded-xl p-4 flex items-center gap-5 border border-white/10">
                        <div class="relative shrink-0">
                            <div class="w-16 h-16 rounded-full p-[2px] bg-gradient-to-tr from-meshy-accent to-transparent">
                                <img src="https://api.dicebear.com/7.x/notionists/svg?seed=Yi" class="w-full h-full rounded-full bg-black object-cover">
                            </div>
                            <div class="absolute -bottom-1 -right-1 bg-black rounded-full p-1">
                                <i class="fa-solid fa-certificate text-meshy-accent text-sm"></i>
                            </div>
                        </div>
                        
                        <div class="flex-1 min-w-0">
                            <p class="text-[10px] text-meshy-accent font-bold tracking-widest uppercase mb-1">Official Invitation</p>
                            <div class="flex items-baseline gap-2">
                                <h3 class="text-white font-bold text-lg truncate">yixiangli</h3>
                                <span class="text-xs text-gray-500">invited you</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-1 truncate">"Check out this 3D model I made!"</p>
                        </div>
                        <div class="text-gray-600">
                            <i class="fa-solid fa-quote-right text-2xl opacity-20"></i>
                        </div>
                    </div>
                </div>

                <!-- 营销文案 -->
                <div class="text-center lg:text-left py-4">
                    <h1 class="text-3xl lg:text-5xl font-extrabold text-white leading-tight mb-4">
                        Unlock Your <br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-meshy-accent to-white">Creative Potential</span>
                    </h1>
                    <p class="text-gray-400 text-sm lg:text-base leading-relaxed">
                        Claim your free month of Meshy Pro. Experience ultra-fast 3D generation, high-poly downloads, and AI texturing tools.
                    </p>
                </div>

                <!-- 礼品详情卡 -->
                <div class="bg-gradient-to-b from-white/5 to-transparent p-6 rounded-2xl border border-white/5">
                    <div class="flex justify-between items-center mb-6 border-b border-white/5 pb-4">
                        <div>
                            <div class="text-white font-bold text-lg">Pro Plan Trial</div>
                            <div class="text-meshy-accent text-xs">Valid for 7 days</div>
                        </div>
                        <div class="text-right">
                            <div class="text-gray-400 line-through text-sm">$20.00</div>
                            <div class="text-white font-bold text-xl">FREE</div>
                        </div>
                    </div>
                    
                    <button class="w-full bg-meshy-accent hover:bg-meshy-accentHover text-black font-extrabold py-3.5 rounded-xl transition-all shadow-neon flex items-center justify-center gap-2 group">
                        Register to Claim
                        <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                    </button>
                    
                    <div class="mt-4 flex justify-center gap-6 text-[10px] text-gray-500">
                        <span><i class="fa-regular fa-circle-check mr-1"></i> No Credit Card</span>
                        <span><i class="fa-regular fa-circle-check mr-1"></i> Cancel Anytime</span>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- 缩略图预览模态框 -->
    <div id="thumbnail-modal" class="hidden fixed inset-0 z-[100] bg-black/90 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-meshy-card border border-white/10 rounded-2xl p-6 max-w-lg w-full">
            <h3 class="text-white font-bold mb-4">Thumbnail Generated</h3>
            <div class="aspect-video bg-black rounded-lg overflow-hidden border border-white/10 mb-4">
                <img id="modal-img" src="" class="w-full h-full object-cover">
            </div>
            <p class="text-sm text-gray-400 mb-6">Right click image to save, or use the button below.</p>
            <div class="flex gap-3">
                <button onclick="document.getElementById('thumbnail-modal').classList.add('hidden')" class="flex-1 py-2.5 rounded-lg border border-white/20 text-white hover:bg-white/5">Close</button>
                <a id="download-link" href="#" download="meshy-thumb.png" class="flex-1 py-2.5 rounded-lg bg-white text-black font-bold text-center hover:bg-gray-200">Download</a>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // ----------------- 逻辑控制 -----------------
        const isEmbed = window.__IS_EMBED__;
        
        if (isEmbed) {
             const cta = document.getElementById('embed-cta');
             if(cta) cta.href = window.location.href.split('?')[0]; 
        }

        const container = document.getElementById('canvas-wrapper');
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(3.5, 2.5, 4.5);

        // 灯光系统
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const mainLight = new THREE.DirectionalLight(0xffffff, 1.8);
        mainLight.position.set(5, 8, 5);
        mainLight.castShadow = true;
        mainLight.shadow.mapSize.set(1024, 1024);
        scene.add(mainLight);
        const rimLight = new THREE.SpotLight(0x6688ff, 3);
        rimLight.position.set(-5, 2, -5);
        scene.add(rimLight);

        // 模型材质引用 (用于更新)
        let modelMaterials = [];
        let isWireframe = false;

        // 创建咖啡杯模型
        function createCoffeeCup() {
            const group = new THREE.Group();
            
            // 材质定义
            const matPaper = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.5, metalness: 0.1, name: 'paper' });
            const matSleeve = new THREE.MeshStandardMaterial({ color: 0xff8800, roughness: 0.8, metalness: 0.0, name: 'sleeve' });
            const matLid = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.2, metalness: 0.1, name: 'lid' });

            modelMaterials = [matPaper, matSleeve, matLid];

            // Body
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.65, 1.4, 64), matPaper);
            body.position.y = 0.7; body.castShadow = true; group.add(body);

            // Sleeve
            const sleeve = new THREE.Mesh(new THREE.CylinderGeometry(0.81, 0.72, 0.6, 64), matSleeve);
            sleeve.position.y = 0.7; sleeve.castShadow = true; group.add(sleeve);
            
            // Sleeve Textures
            for(let i=0; i<6; i++) {
                const ring = new THREE.Mesh(new THREE.TorusGeometry(0.77, 0.005, 4, 64), new THREE.MeshBasicMaterial({color: 0xcc6600}));
                ring.rotation.x = Math.PI/2; 
                ring.position.y = 0.55 + i*0.06; 
                group.add(ring);
            }

            // Lid
            const lidGroup = new THREE.Group();
            const lidRim = new THREE.Mesh(new THREE.CylinderGeometry(0.85, 0.85, 0.15, 64), matLid);
            lidRim.position.y = 1.45;
            lidGroup.add(lidRim);
            const lidTop = new THREE.Mesh(new THREE.CylinderGeometry(0.75, 0.8, 0.1, 64), matLid);
            lidTop.position.y = 1.55;
            lidGroup.add(lidTop);
            const hole = new THREE.Mesh(new THREE.CapsuleGeometry(0.06, 0.1, 4, 8), new THREE.MeshStandardMaterial({color:0x000000}));
            hole.position.set(0, 1.62, 0.5);
            hole.rotation.x = Math.PI/2;
            lidGroup.add(hole);

            lidGroup.castShadow = true;
            group.add(lidGroup);
            
            // Shadow Plane
            const plane = new THREE.Mesh(new THREE.PlaneGeometry(8,8), new THREE.ShadowMaterial({opacity:0.3}));
            plane.rotation.x = -Math.PI/2; plane.receiveShadow = true; group.add(plane);

            return group;
        }
        const model = createCoffeeCup();
        scene.add(model);

        // 控制器
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enablePan = false;
        controls.minDistance = 2;
        controls.maxDistance = 10;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 2.0;
        
        // 交互时暂停旋转
        controls.addEventListener('start', () => {
             // 仅为了更平滑的体验，不做强制停止
        });

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // 窗口调整
        function onWindowResize() {
            const width = container.clientWidth;
            const height = container.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        window.addEventListener('resize', onWindowResize);
        onWindowResize();

        // ----------------- UI 交互功能 -----------------
        
        // 1. 更新材质 (PBR)
        window.updateMaterial = function(prop, val) {
            const value = parseFloat(val);
            document.getElementById(`val-${prop}`).innerText = value;
            modelMaterials.forEach(mat => {
                if(mat[prop] !== undefined) mat[prop] = value;
            });
        };

        // 2. 切换线框
        window.toggleWireframe = function() {
            isWireframe = !isWireframe;
            const btn = document.getElementById('btn-wireframe');
            btn.classList.toggle('active', isWireframe);
            
            modelMaterials.forEach(mat => {
                mat.wireframe = isWireframe;
            });
        };

        // 3. 切换 PBR 弹窗
        window.togglePBRPopup = function() {
            const popup = document.getElementById('pbr-popup');
            const btn = document.getElementById('btn-pbr');
            popup.classList.toggle('hidden');
            btn.classList.toggle('active', !popup.classList.contains('hidden'));
        };

        // 4. 切换自动旋转
        window.toggleAutoRotate = function(isChecked) {
            controls.autoRotate = isChecked;
        };

        // 5. 截图
        window.takeScreenshot = function() {
            const overlay = document.getElementById('flash-overlay');
            overlay.classList.add('do-flash');
            setTimeout(() => overlay.classList.remove('do-flash'), 500);
            
            renderer.render(scene, camera);
            
            try {
                const dataURL = renderer.domElement.toDataURL('image/png');
                const modal = document.getElementById('thumbnail-modal');
                const img = document.getElementById('modal-img');
                const btn = document.getElementById('download-link');
                img.src = dataURL;
                btn.href = dataURL;
                modal.classList.remove('hidden');
            } catch (e) {
                console.error(e);
                alert("Screenshot failed.");
            }
        };

    </script>
</body>
</html>
